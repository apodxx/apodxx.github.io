---
layout: post
title: numpy基础10 np文件保存及广播
date: 2021-02-03
tag: 机器学习
---


```python
import numpy as np
```

ndarray对象可以保存到磁盘文件并从磁盘文件加载。 可用的 IO 功能有：

load()和save()函数处理 numPy 二进制文件(带npy扩展名)

loadtxt()和savetxt()函数处理正常的文本文件


```python
a = np.array([1,2,3,4,5])
```


```python
np.save('some_array',a)   #自动添加扩展名
```


```python
b = np.load('some_array.npy')
```


```python
b
```




    array([1, 2, 3, 4, 5])




```python
np.savetxt('out.txt',a) 
```


```python
c = np.loadtxt('out.txt')
```


```python
c
```




    array([ 1.,  2.,  3.,  4.,  5.])



最后，性能提示

1.numpy代码性能非常好，要比纯python代码快十倍以上，甚至比pandas快很多，当你需要快速处理大量数据的时候，要求速度优先的时候，可以考虑使用numpy来处理

2.尽可能使用    广播

代码的向量化可以使你执行速度更快，代码更紧凑，避免使用循环


```python
x = np.random.randn(3,4)
```

要计算x的平方加10


```python
x**2 +10
```




    array([[ 10.46626671,  14.0044707 ,  11.40247483,  10.55460255],
           [ 12.46421573,  11.77153194,  11.01767525,  10.02892093],
           [ 12.28336534,  10.99887027,  11.16275017,  11.23052399]])




```python
x.mean(0)
```




    array([-0.20804534,  0.77755716,  1.09045639,  0.17821166])




```python
demean = x - x.mean()
demean
```




    array([[-1.14238221,  1.5415724 ,  0.72471634, -1.20426139],
           [ 1.1102371 ,  0.87144412,  0.54925395, -0.28948341],
           [-1.97062582, -1.45897994,  0.61876397,  0.64974489]])



广播原则

如果两个数组的后缘维度（从最后看的维度）轴长相符，或者其中一方长度为1 ，则认为他们是广播兼容的


```python
a = np.random.randn(4,3)
a
```




    array([[-1.15140182, -0.25709778,  0.37554919],
           [-0.9114124 ,  0.91079124, -0.59558631],
           [-0.54996033,  0.48738442,  1.87301695],
           [ 0.36782045, -0.53702185, -1.12481913]])




```python
b = a.mean(1)
```


```python
np.shape(a),np.shape(b)
```




    ((4, 3), (4,))




```python
a - b
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-37-a5f966a4b1f4> in <module>()
    ----> 1 a - b
    

    ValueError: operands could not be broadcast together with shapes (4,3) (4,) 



```python
a
```




    array([[-1.15140182, -0.25709778,  0.37554919],
           [-0.9114124 ,  0.91079124, -0.59558631],
           [-0.54996033,  0.48738442,  1.87301695],
           [ 0.36782045, -0.53702185, -1.12481913]])




```python
b
```




    array([-0.34431681, -0.19873583,  0.60348034, -0.43134018])




```python
b.reshape(4,1)
```




    array([[-0.34431681],
           [-0.19873583],
           [ 0.60348034],
           [-0.43134018]])




```python
a - b.reshape(4,1)
```




    array([[-0.80708501,  0.08721902,  0.71986599],
           [-0.71267658,  1.10952706, -0.39685048],
           [-1.15344068, -0.11609593,  1.26953661],
           [ 0.79916063, -0.10568168, -0.69347895]])



高纬度的广播

三维的广播也需要将数据重塑为兼容的形状


```python
a = np.random.randn(3,4,5)
a
```




    array([[[-0.39163544,  0.25616751,  1.19994491,  0.48983525,  0.60281775],
            [-1.39572334,  0.19503235,  0.25192711, -0.3485233 , -1.23437806],
            [ 0.01506848, -0.38290691, -1.87232891, -0.76063451, -0.0374243 ],
            [-0.20356391,  0.62555234,  1.65767105,  0.71151877, -0.0360855 ]],
    
           [[ 0.0246793 ,  0.34571469, -0.43894117,  0.35620262, -1.02696798],
            [ 1.27569251,  0.56864819, -1.46211938,  0.15867037,  0.51795598],
            [-0.67319193,  0.19620267, -1.38352991, -0.8941149 , -0.60242568],
            [ 1.01174035,  0.14213482,  0.34800978,  0.50878873, -0.28016828]],
    
           [[-0.41733062, -0.61912858, -2.04634123,  0.78856151,  2.00371198],
            [ 1.3746788 ,  0.339666  , -1.24531398, -0.48566079,  1.34588104],
            [-1.9106813 , -0.01309925,  0.41822276, -0.5957454 ,  0.83462486],
            [ 0.31305861,  2.22903993, -0.52987705,  1.12896576,  0.56888695]]])




```python
d_mean = a.mean(2)
d_mean
```




    array([[ 0.43142599, -0.50633305, -0.60764523,  0.55101855],
           [-0.14786251,  0.21176953, -0.67141195,  0.34610108],
           [-0.05810539,  0.26585022, -0.25333566,  0.74201484]])




```python
d_mean_new = d_mean[:,:,np.newaxis]
d_mean_new
```




    array([[[ 0.43142599],
            [-0.50633305],
            [-0.60764523],
            [ 0.55101855]],
    
           [[-0.14786251],
            [ 0.21176953],
            [-0.67141195],
            [ 0.34610108]],
    
           [[-0.05810539],
            [ 0.26585022],
            [-0.25333566],
            [ 0.74201484]]])




```python
np.shape(d_mean_new)
```




    (3, 4, 1)




```python
a - d_mean_new
```




    array([[[ -8.23061435e-01,  -1.75258486e-01,   7.68518915e-01,
               5.84092511e-02,   1.71391755e-01],
            [ -8.89390291e-01,   7.01365399e-01,   7.58260159e-01,
               1.57809745e-01,  -7.28045013e-01],
            [  6.22713711e-01,   2.24738320e-01,  -1.26468368e+00,
              -1.52989280e-01,   5.70220930e-01],
            [ -7.54582462e-01,   7.45337909e-02,   1.10665250e+00,
               1.60500220e-01,  -5.87104046e-01]],
    
           [[  1.72541806e-01,   4.93577199e-01,  -2.91078666e-01,
               5.04065126e-01,  -8.79105466e-01],
            [  1.06392297e+00,   3.56878659e-01,  -1.67388891e+00,
              -5.30991654e-02,   3.06186444e-01],
            [ -1.77997631e-03,   8.67614621e-01,  -7.12117964e-01,
              -2.22702953e-01,   6.89862722e-02],
            [  6.65639271e-01,  -2.03966257e-01,   1.90869698e-03,
               1.62687647e-01,  -6.26269359e-01]],
    
           [[ -3.59225235e-01,  -5.61023191e-01,  -1.98823584e+00,
               8.46666900e-01,   2.06181737e+00],
            [  1.10882858e+00,   7.38157872e-02,  -1.51116419e+00,
              -7.51511004e-01,   1.08003083e+00],
            [ -1.65734563e+00,   2.40236417e-01,   6.71558422e-01,
              -3.42409733e-01,   1.08796053e+00],
            [ -4.28956234e-01,   1.48702509e+00,  -1.27189189e+00,
               3.86950920e-01,  -1.73127890e-01]]])



3.避免复制数据，尽量使用数组切片视图

4.充分使用numpy的通用函数和统计方法


```python

```
